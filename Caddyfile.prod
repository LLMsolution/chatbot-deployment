  {
      email jesse@llm-solution.cloud
  }

  # API Backend
  api.llm-solution.cloud {
      # Security headers
      header {
          Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
          X-Frame-Options "DENY"
          X-XSS-Protection "1; mode=block"
          Referrer-Policy "strict-origin-when-cross-origin"
          Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=()"
      }

      # Increased request body size limit for file uploads (5MB)
      request_body {
          max_size 5MB
      }

      # Standard proxy for all endpoints
      reverse_proxy agent-api:8001 {
          header_up X-Real-IP {remote_host}
          header_up X-Forwarded-For {remote_host}
          header_up X-Forwarded-Proto {scheme}
      }
  }

  # Frontend
  schielandbusiness.llm-solution.cloud {
      # Security headers
      header {
          Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
          Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.gpteng.co; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data: https://r2cdn.perplexity.ai; connect-src 'self' ws: wss: ht>
          X-Content-Type-Options "nosniff"
          X-Frame-Options "DENY"
          X-XSS-Protection "1; mode=block"
          Referrer-Policy "strict-origin-when-cross-origin"
          Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=()"
      }

      # Request body size limit (5MB for frontend uploads)
      request_body {
          max_size 5MB
      }

      # Gzip compression
      encode {
          gzip 6
      }

      reverse_proxy frontend:8080 {
          header_up X-Real-IP {remote_host}
          header_up X-Forwarded-For {remote_host}
          header_up X-Forwarded-Proto {scheme}
      }
  }
graph.llmsolution.nl {
    # Security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Neo4j Browser (HTTP interface)
    reverse_proxy neo4j-graph:7474
}

# Bolt+s proxy - TLS termination door Caddy, dan naar Neo4j Bolt
bolt.llmsolution.nl {
    reverse_proxy neo4j-graph:7687
}

# Website Chatbot API
api.llmsolution.nl {
    # Security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Request body size limit
    request_body {
        max_size 1MB
    }

    # Proxy naar agent-api (CORS handled by FastAPI)
    reverse_proxy 172.18.0.9:8002 {
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}

        # Streaming support - flush immediately for SSE/streaming responses
        flush_interval -1

        # Health check to detect unhealthy backend
        health_uri /health
        health_interval 10s
        health_timeout 5s

        # Connection timeouts
        transport http {
            keepalive 30s
            keepalive_idle_conns 10
        }
    }

